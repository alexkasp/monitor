(function(){var z=Math.min,mmax=Math.max;function finger(x,y,a,b,c,d,e,f){var g,ends={round:'round',sharp:'sharp',soft:'soft',square:'square'};if((c&&!b)||(!c&&!a)){return e?"":f.path()}d=ends[d]||"square";b=Math.round(b);a=Math.round(a);x=Math.round(x);y=Math.round(y);switch(d){case"round":if(!c){var r=~~(b/2);if(a<r){r=a;g=["M",x+.5,y+.5-~~(b/2),"l",0,0,"a",r,~~(b/2),0,0,1,0,b,"l",0,0,"z"]}else{g=["M",x+.5,y+.5-r,"l",a-r,0,"a",r,r,0,1,1,0,b,"l",r-a,0,"z"]}}else{r=~~(a/2);if(b<r){r=b;g=["M",x-~~(a/2),y,"l",0,0,"a",~~(a/2),r,0,0,1,a,0,"l",0,0,"z"]}else{g=["M",x-r,y,"l",0,r-b,"a",r,r,0,1,1,a,0,"l",0,b-r,"z"]}}break;case"sharp":if(!c){var h=~~(b/2);g=["M",x,y+h,"l",0,-b,mmax(a-h,0),0,z(h,a),h,-z(h,a),h+(h*2<b),"z"]}else{h=~~(a/2);g=["M",x+h,y,"l",-a,0,0,-mmax(b-h,0),h,-z(h,b),h,z(h,b),h,"z"]}break;case"square":if(!c){g=["M",x,y+~~(b/2),"l",0,-b,a,0,0,b,"z"]}else{g=["M",x+~~(a/2),y,"l",1-a,0,0,-b,a-1,0,"z"]}break;case"soft":if(!c){r=z(a,Math.round(b/5));g=["M",x+.5,y+.5-~~(b/2),"l",a-r,0,"a",r,r,0,0,1,r,r,"l",0,b-r*2,"a",r,r,0,0,1,-r,r,"l",r-a,0,"z"]}else{r=z(Math.round(a/5),b);g=["M",x-~~(a/2),y,"l",0,r-b,"a",r,r,0,0,1,r,-r,"l",a-2*r,0,"a",r,r,0,0,1,r,r,"l",0,b-r,"z"]}}if(e){return g.join(",")}else{return f.path(g)}}function VBarchart(g,x,y,k,m,n,o){o=o||{};var p=this,type=o.type||"square",gutter=parseFloat(o.gutter||"20%"),chart=g.set(),bars=g.set(),covers=g.set(),covers2=g.set(),total=Math.max.apply(Math,n),stacktotal=[],multi=0,colors=o.colors||p.colors,len=n.length;if(Raphael.is(n[0],"array")){total=[];multi=len;len=0;for(var i=n.length;i--;){bars.push(g.set());total.push(Math.max.apply(Math,n[i]));len=Math.max(len,n[i].length)}if(o.stacked){for(var i=len;i--;){var q=0;for(var j=n.length;j--;){q+=+n[j][i]||0}stacktotal.push(q)}}for(var i=n.length;i--;){if(n[i].length<len){for(var j=len;j--;){n[i].push(0)}}}total=Math.max.apply(Math,o.stacked?stacktotal:total)}total=(o.to)||total;var r=k/(len*(100+gutter)+gutter)*100,barhgutter=r*gutter/100,barvgutter=o.vgutter==null?20:o.vgutter,stack=[],X=x+barhgutter,Y=(m-2*barvgutter)/total;if(!o.stretch){barhgutter=Math.round(barhgutter);r=Math.floor(r)}!o.stacked&&(r/=multi||1);for(var i=0;i<len;i++){stack=[];for(var j=0;j<(multi||1);j++){var h=Math.round((multi?n[j][i]:n[i])*Y),top=y+m-barvgutter-h,v=finger(Math.round(X+r/2),top+h,r,h,true,type,null,g).attr({stroke:"none",fill:colors[multi?j:i]});if(multi){bars[j].push(v)}else{bars.push(v)}v.y=top;v.x=Math.round(X+r/2);v.w=r;v.h=h;v.value=multi?n[j][i]:n[i];if(!o.stacked){X+=r}else{stack.push(v)}}if(o.stacked){var t;covers2.push(t=g.rect(stack[0].x-stack[0].w/2,y,r,m).attr(p.shim));t.bars=g.set();var u=0;for(var s=stack.length;s--;){stack[s].toFront()}for(var s=0,ss=stack.length;s<ss;s++){var v=stack[s],w,h=(u+v.value)*Y,path=finger(v.x,y+m-barvgutter-!!u*.5,r,h,true,type,1,g);t.bars.push(v);u&&v.attr({path:path});v.h=h;v.y=y+m-barvgutter-!!u*.5-h;covers.push(w=g.rect(v.x-v.w/2,v.y,r,v.value*Y).attr(p.shim));w.bar=v;w.value=v.value;u+=v.value}X+=r}X+=barhgutter}covers2.toFront();X=x+barhgutter;if(!o.stacked){for(var i=0;i<len;i++){for(var j=0;j<(multi||1);j++){var w;covers.push(w=g.rect(Math.round(X),y+barvgutter,r,m-barvgutter).attr(p.shim));w.bar=multi?bars[j][i]:bars[i];w.value=w.bar.value;X+=r}X+=barhgutter}}chart.label=function(a,b){a=a||[];this.labels=g.set();var L,l=-Infinity;if(o.stacked){for(var i=0;i<len;i++){var c=0;for(var j=0;j<(multi||1);j++){c+=multi?n[j][i]:n[i];if(j==multi-1){var d=g.labelise(a[i],c,total);L=g.text(bars[i*(multi||1)+j].x,y+m-barvgutter/2,d).attr(txtattr).insertBefore(covers[i*(multi||1)+j]);var e=L.getBBox();if(e.x-7<l){L.remove()}else{this.labels.push(L);l=e.x+e.width}}}}}else{for(var i=0;i<len;i++){for(var j=0;j<(multi||1);j++){var d=g.labelise(multi?a[j]&&a[j][i]:a[i],multi?n[j][i]:n[i],total);L=g.text(bars[i*(multi||1)+j].x,b?y+m-barvgutter/2:bars[i*(multi||1)+j].y-10,d).attr(txtattr).insertBefore(covers[i*(multi||1)+j]);var e=L.getBBox();if(e.x-7<l){L.remove()}else{this.labels.push(L);l=e.x+e.width}}}}return this};chart.hover=function(a,b){covers2.hide();covers.show();covers.mouseover(a).mouseout(b);return this};chart.hoverColumn=function(a,b){covers.hide();covers2.show();b=b||function(){};covers2.mouseover(a).mouseout(b);return this};chart.click=function(f){covers2.hide();covers.show();covers.click(f);return this};chart.each=function(f){if(!Raphael.is(f,"function")){return this}for(var i=covers.length;i--;){f.call(covers[i])}return this};chart.eachColumn=function(f){if(!Raphael.is(f,"function")){return this}for(var i=covers2.length;i--;){f.call(covers2[i])}return this};chart.clickColumn=function(f){covers.hide();covers2.show();covers2.click(f);return this};chart.push(bars,covers,covers2);chart.bars=bars;chart.covers=covers;return chart};var F=function(){};F.prototype=Raphael.g;HBarchart.prototype=VBarchart.prototype=new F;Raphael.fn.barchart=function(x,y,a,b,c,d){return new VBarchart(this,x,y,a,b,c,d)};function HBarchart(c,x,y,d,e,g,h){h=h||{};var k=this,type=h.type||"square",gutter=parseFloat(h.gutter||"20%"),chart=c.set(),bars=c.set(),covers=c.set(),covers2=c.set(),rtl=h.rtl,total=Math.max.apply(Math,g),stacktotal=[],multi=0,colors=h.colors||k.colors,len=g.length;if(Raphael.is(g[0],"array")){total=[];multi=len;len=0;for(var i=g.length;i--;){bars.push(c.set());total.push(Math.max.apply(Math,g[i]));len=Math.max(len,g[i].length)}if(h.stacked){for(var i=len;i--;){var l=0;for(var j=g.length;j--;){l+=+g[j][i]||0}stacktotal.push(l)}}for(var i=g.length;i--;){if(g[i].length<len){for(var j=len;j--;){g[i].push(0)}}}total=Math.max.apply(Math,h.stacked?stacktotal:total)}total=(h.to)||total;var m=Math.floor(e/(len*(100+gutter)+gutter)*100),bargutter=Math.floor(m*gutter/100),stack=[],Y=y+bargutter,X=(d-1)/total;!h.stacked&&(m/=multi||1);for(var i=0;i<len;i++){stack=[];for(var j=0;j<(multi||1);j++){var n=multi?g[j][i]:g[i],q=finger(rtl?d+x+25-Math.round(n*X):x,Y+m/2,Math.round(n*X),m-1,false,type,null,c).attr({stroke:"none",fill:colors[multi?j:i]});if(multi){bars[j].push(q)}else{bars.push(q)}q.x=rtl?d+x+25-Math.round(n*X):x+Math.round(n*X);q.y=Y+m/2;q.w=Math.round(n*X);q.h=m;q.value=+n;if(!h.stacked){Y+=m}else{stack.push(q)}}if(h.stacked){var o=c.rect(x,stack[0].y-stack[0].h/2,d,m).attr(k.shim);covers2.push(o);o.bars=c.set();var p=0;for(var s=stack.length;s--;){stack[s].toFront()}for(var s=0,ss=stack.length;s<ss;s++){var q=stack[s],r,n=Math.round((p+q.value)*X),path=finger(x,q.y,n,m-1,false,type,1,c);o.bars.push(q);p&&q.attr({path:path});q.w=n;q.x=x+n;covers.push(r=c.rect(x+p*X,q.y-q.h/2,q.value*X,m).attr(k.shim));r.bar=q;p+=q.value}Y+=m}Y+=bargutter}covers2.toFront();Y=y+bargutter;if(!h.stacked){for(var i=0;i<len;i++){for(var j=0;j<(multi||1);j++){var r=c.rect(x,Y,d,m).attr(k.shim);covers.push(r);r.bar=multi?bars[j][i]:bars[i];r.value=r.bar.value;Y+=m}Y+=bargutter}}chart.label=function(a){a=a||[];this.labels=c.set();for(var i=0;i<len;i++){for(var j=0;j<multi;j++){var b=multi?g[j][i]:g[i],label2=multi>1?a[j]&&a[j][i]:a[i];var X=rtl?bars[j][i].x-5:bars[j][i].x+3,A=rtl?"end":"start",L,L2;if(label2)this.labels.push(L2=c.text(rtl?x+d+22:x+3,bars[j][i].y-1,label2).attr({"text-anchor":A,fill:"#182d34",font:"10px 'Trebuchet MS', Arial"}).insertBefore(covers[0]));this.labels.push(L=c.text(X,bars[j][i].y-1,b).attr({"text-anchor":A,fill:"#ffffff",font:"10px 'Trebuchet MS', Arial"}).insertBefore(covers[0]));bars[j][i].label=L}}return this};chart.hover=function(a,b){covers2.hide();covers.show();b=b||function(){};covers.mouseover(a).mouseout(b);return this};chart.hoverColumn=function(a,b){covers.hide();covers2.show();b=b||function(){};covers2.mouseover(a).mouseout(b);return this};chart.each=function(f){if(!Raphael.is(f,"function")){return this}for(var i=covers.length;i--;){f.call(covers[i])}return this};chart.eachColumn=function(f){if(!Raphael.is(f,"function")){return this}for(var i=covers2.length;i--;){f.call(covers2[i])}return this};chart.click=function(f){covers2.hide();covers.show();covers.click(f);return this};chart.clickColumn=function(f){covers.hide();covers2.show();covers2.click(f);return this};chart.push(bars,covers,covers2);chart.bars=bars;chart.covers=covers;return chart};Raphael.fn.hbarchart=function(x,y,a,b,c,d){return new HBarchart(this,x,y,a,b,c,d)}})();